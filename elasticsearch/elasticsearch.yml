cluster:
  name: "elk-cluster"
  routing.allocation.awareness.attributes: aws_availability_zone

cloud.node.auto_attributes: true

node:
  name: ${HOSTNAME}
  master: true
  data: true

discovery:
  ec2:
    availability_zones: eu-west-2a,eu-west-2b,eu-west-2c
    node_cache_time: 120s
    groups: ${CLUSTER_SECURITY_GROUP}
    endpoint: ec2.eu-west-2.amazonaws.com
    host_type: private_ip
  zen:
    hosts_provider: ec2
    join_timeout: 90s
    ping_timeout: 60s
    minimum_master_nodes: 2

http.port: 9200
transport.tcp.port: 9300
transport.connect_timeout: 60s

network.host:
- eth0:ipv4
- _local_
network.bind_host: 0
network.publish_host: _ec2:privateIp_

plugin.mandatory:
- discovery-ec2
- repository-s3

#xpack.security.audit.enabled: false
#xpack.security.audit.outputs: [ logfile ]

xpack.ssl.key:                     /usr/share/elasticsearch/config/node.key
xpack.ssl.certificate:             /usr/share/elasticsearch/config/node.crt
xpack.ssl.certificate_authorities: [ "/usr/share/elasticsearch/config/ca.crt" ]

# Unfortunately this setting is required
xpack.ssl.verification_mode: none

xpack.monitoring.enabled: true
xpack.monitoring.elasticsearch.collection.enabled: true

logger.discovery: "TRACE"

xpack:
  security:
    audit:
      enabled: false
      outputs: [logfile]
    enabled: true
    http:
      ssl:
        enabled: true
        key: "/usr/share/elasticsearch/config/node.key"
        certificate: "/usr/share/elasticsearch/config/node.crt"
        certificate_authorities: [ "/usr/share/elasticsearch/config/ca.crt" ]
    transport:
      ssl:
        enabled: true
        verification_mode: none
    authc:
      token:
        enabled: true
      realms:
        native1:
          type: native
          order: 0
        saml1:
          type: saml
          order: 1
          attributes.principal: "nameid"
          attributes.groups: "groups"
          idp.metadata.path: "https://sso.trade.uat.uktrade.io/idp/metadata/"
          idp.entity_id: "https://sso.trade.uat.uktrade.io/idp/metadata"
          sp.entity_id: "https://elk.ci.uktrade.io:443/"
          sp.acs: "https://elk.ci.uktrade.io:443/api/security/v1/saml"
          sp.logout: "https://elk.ci.uktrade.io/logout"
          signing.key: "/usr/share/elasticsearch/config/saml/saml.key"
          signing.certificate: "/usr/share/elasticsearch/config/saml/saml.crt"
          signing.saml_messages: AuthnRequest
